function fromBase64(base64string) {
  return (
    base64string
      .replace(/=/g, '')
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
  );
}

function toBase64(base64UrlString) {
  if (Buffer.isBuffer(base64UrlString))
    base64UrlString = base64UrlString.toString();

<<<<<<< HEAD
  var b64str = padString(base64UrlString)
=======
  const b64str = padString(base64UrlString)
>>>>>>> 28c6f978a4ba08bdae3bd531dac6bebf07cd4f5d
    .replace(/\-/g, '+')
    .replace(/_/g, '/');
  return b64str;
}

function padString(string) {
<<<<<<< HEAD
  var segmentLength = 4;
  var stringLength = string.length;
  var diff = string.length % segmentLength;
=======
  const segmentLength = 4;
  const stringLength = string.length;
  const diff = string.length % segmentLength;
>>>>>>> 28c6f978a4ba08bdae3bd531dac6bebf07cd4f5d
  if (!diff)
    return string;
  var position = stringLength;
  var padLength = segmentLength - diff;
<<<<<<< HEAD
  var paddedStringLength = stringLength + padLength;
  var buffer = Buffer(paddedStringLength);
=======
  const paddedStringLength = stringLength + padLength;
  const buffer = Buffer(paddedStringLength);
>>>>>>> 28c6f978a4ba08bdae3bd531dac6bebf07cd4f5d
  buffer.write(string);
  while (padLength--)
    buffer.write('=', position++);
  return buffer.toString();
}

function decodeBase64Url(base64UrlString, encoding) {
  return Buffer(toBase64(base64UrlString), 'base64').toString(encoding);
}

function base64url(stringOrBuffer, encoding) {
  return fromBase64(Buffer(stringOrBuffer, encoding).toString('base64'));
}

function toBuffer(base64string) {
  return Buffer(toBase64(base64string), 'base64');
}

base64url.toBase64 = toBase64;
base64url.fromBase64 = fromBase64;
base64url.decode = decodeBase64Url;
base64url.encode = base64url;
base64url.toBuffer = toBuffer;

module.exports = base64url;
